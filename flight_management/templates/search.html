<{% extends 'layout/base.html' %}
{% block title %}Tra cứu chuyến bay{% endblock %}
{% block content %}
<link rel="stylesheet" href="/static/css/search.css"/>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<section class="section__container header__container">
    <h1 class="section__header">TRA CỨU CHUYẾN BAY</h1>
</section>

<section class="section__container booking__container">
    <h2 class="section__header">Nhập thông tin yêu cầu của khách hàng</h2>
    <div class="booking__nav">
        {% if mode == 1%}
        <span class="option" id="one_way_option">Một Chiều</span>
        <span class="option selected" id="round_trip_option">Khứ Hồi</span>
        {% else %}
        <span class="option selected" id="one_way_option">Một Chiều</span>
        <span class="option" id="round_trip_option">Khứ Hồi</span>
        {% endif %}

    </div>
    <form action="/search" class="booking__form" method="get" id="myForm">
        <div class="row">
            <div class="row">
                <div class="form__group col">
                    <span><strong><i class="fas fa-plane-departure"></i> Nơi Đi</strong></span>
                    <select class="form-control form-control-md" id="from" name="from">
                        <option value="0">-- Chọn nơi đi --</option>
                        {% if airport %}
                            {% if request.args.get('from') %}
                                {% for p in airport %}
                                    {% if request.args.get('from') | int == p.id %}
                                        <option selected value="{{p.id}}">{{p.address}}</option>
                                    {% else %}
                                        <option value="{{p.id}}">{{p.address}}</option>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                {% for p in airport %}
        <!--                        airport: danh sach san bay-->
        <!--                        p: san bay-->
                                    <option value="{{p.id}}">{{p.address}}</option>
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                    </select>
                </div>
                <div class="form__group col">
                    <span><strong><i class="fas fa-plane"></i>Nơi Đến</strong></span>
                    <select class="form-control form-control-md" id="to" name="to">
                        <option value="0">-- Chọn nơi đến --</option>
                        {% if airport %}
                        {% if  request.args.get('to') %}
                        {% for p in airport %}
                        {% if  request.args.get('to') | int == p.id %}
                        <option selected value="{{p.id}}">{{p.address}}</option>
                        {% else %}
                        <option value="{{p.id}}">{{p.address}}</option>
                        {% endif %}
                        {% endfor %}
                        {% else %}
                        {% for p in airport %}
                        <option value="{{p.id}}">{{p.address}}</option>
                        {% endfor %}
                        {% endif %}
                        {% endif %}
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form__group col">
                    <span><strong>Ngày đi</strong></span>
                    {% if departure %}
                    <input class="form-control " id="departure" name="departure" type="date" value="{{departure}}">
                    {% else %}
                    <input class="form-control" id="departure" name="departure" type="date">
                    {% endif %}
                </div>
                <div class="form__group col" style="display: none;" id="return_date_group">
                    <span><strong>Ngày về</strong></span>
                    {% if return %}
                    <input class="form-control" id="return" name="return" type="date" value="{{return}}">
                    {% else %}
                    <input class="form-control " id="return" name="return" type="date">
                    {% endif %}
                </div>

            </div>
            <div class="row">
                <div class="col d-flex justify-content-center mt-3">
                    <button class="btn btn-primary d-flex gap-2" type="submit">
                        <i class="fas fa-search"></i>Tìm kiếm
                    </button>
                    <button class="btn btn-danger d-flex gap-2 ms-5" onclick="clearInput()" type="button">
                        <i class="fas fa-trash"></i>Xoá
                    </button>
                    <script>
                        function clearInput() {
                            document.getElementById("from").value = "0";
                            document.getElementById("to").value = "0";
                            document.getElementById("departure").value = "";
                            document.getElementById("return").value = "";
                        }
                    </script>
                </div>
            </div>
        </div>
        <script>
            const today = new Date();
            const formattedDate = today.toISOString().slice(0, 10); // "YYYY-MM-DD"
            document.getElementById("return").min = formattedDate;
            document.getElementById("departure").min = formattedDate;
            document.getElementById("return").value = formattedDate;
            document.getElementById("departure").value = formattedDate;
        </script>
    </form>
    <script>
        const oneWayOption = document.getElementById('one_way_option');
        const roundTripOption = document.getElementById('round_trip_option');
        const returnDateGroup = document.getElementById('return_date_group');
        const returnDateInput = document.getElementById('return');
        const mode = document.getElementById('mode');

<!--        // Hàm để kiểm tra và điều chỉnh khi chọn "Một Chiều" hoặc "Khứ Hồi"-->
    function toggleReturnDate() {
        if (roundTripOption.classList.contains('selected')) {
<!--            // Khi chọn "Khứ Hồi", ẩn và vô hiệu hóa trường "Ngày về"-->
            returnDateGroup.style.display = 'block';
            returnDateInput.disabled = false; // Cho phép nhập ngày về

        } else {
<!--            // Khi chọn "Một Chiều", ẩn và vô hiệu hóa trường "Ngày về"-->
            returnDateGroup.style.display = 'none';
            returnDateInput.disabled = true; // Vô hiệu hóa trường "Ngày về"
        }
    }

<!--    // Lắng nghe sự kiện khi chọn "Một Chiều" hoặc "Khứ Hồi"-->
    oneWayOption.addEventListener('click', function() {
<!--        // Chuyển sang chọn "Một Chiều"-->
        oneWayOption.classList.add('selected');
        roundTripOption.classList.remove('selected');
        toggleReturnDate();
    });

    roundTripOption.addEventListener('click', function() {
<!--        // Chuyển sang chọn "Khứ Hồi"-->
        roundTripOption.classList.add('selected');
        oneWayOption.classList.remove('selected');
        toggleReturnDate();
    });

    toggleReturnDate();

<!--        oneWayOption.addEventListener('click', () => {-->
<!--            returnDateGroup.style.display = 'none';-->

<!--        });-->

<!--        roundTripOption.addEventListener('click', () => {-->
<!--            returnDateGroup.style.display = 'block';-->
<!--        });-->

<!--        const options = document.querySelectorAll('.option');-->

<!--        options.forEach(option => {-->
<!--            option.addEventListener('click', () => {-->
<!--                options.forEach(opt => opt.classList.remove('selected'));-->

<!--                option.classList.add('selected');-->
<!--            });-->
<!--        });-->
    </script>
    <div class="shadow-sm p-3 mb-5 bg-body-tertiary rounded mt-3">
        {% if list_flight %}
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% for p in list_flight %}
            <div class="col">
                <div class="card h-100 border-primary">
                    <div class="card-body">
                        <h5 class="card-title text-primary">{{ p.flight_route.getAddress() }}</h5>
                        <p class="card-text">
                                <span class="d-block mb-2">
                                    <i class="bi bi-calendar3 me-2 text-secondary"></i>
                                    <strong>Ngày bay:</strong> {{ p.start_datetime.strftime('%Y-%m-%d')}}
                                </span>
                            <span class="d-block mb-2">
                                    <i class="bi bi-clock me-2 text-secondary"></i>
                                    <strong>Giờ bay:</strong> {{ p.start_datetime.strftime('%H:%M:%S')}}
                                </span>
                            <span class="d-block mb-2">
                                    <i class="bi bi-hourglass-split me-2 text-secondary"></i>
                                    <strong>Thời gian bay:</strong> {{ p.getHour() }}
                                </span>
                        </p>
                        <a class="btn btn-primary" href="/tickets_info/{{ p.id }}">
                            Đặt vé
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <h3 align="center" class="text text-danger">Không tìm thấy chuyến bay phù hợp</h3>
        {% endif %}
    </div>
    {% endblock %}